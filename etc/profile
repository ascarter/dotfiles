# dotfiles shell configuration

# Configure readline
export INPUTRC="${XDG_CONFIG_HOME}/readline/inputrc"

# Homebrew
# * Verify brew is installed
# * Intialize brew for shell environment if interactive
export HOMEBREW_NO_EMOJI=1
export HOMEBREW_DOWNLOAD_CONCURRENCY=auto
if [[ $- == *i* ]]; then
  if [ -d /opt/homebrew ]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [ -d /home/linuxbrew/.linuxbrew ]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  fi
fi

# Set SSH key provider for FIDO2
if [ -f /usr/local/lib/sk-libfido2.dylib ]; then
  export SSH_SK_PROVIDER=/usr/local/lib/sk-libfido2.dylib
fi

if command -v ssh-askpass >/dev/null; then
  export SSH_ASKPASS=ssh-askpass
  export DISPLAY=:0
fi

if [ -n "${SSH_CONNECTION}" ]; then
  export PINENTRY_USER_DATA=USE_CURSES=1
  export GPG_TTY=$(tty)
fi

# Detect shell and run matching rc script
if [ -n "$BASH_VERSION" ]; then
  [ -f ${DOTFILES}/etc/bashrc ] && . ${DOTFILES}/etc/bashrc
elif [ -n "$ZSH_VERSION" ]; then
  [ -f ${DOTFILES}/etc/zshrc ] && . ${DOTFILES}/etc/zshrc
fi

if [ -d ${DOTFILES}/etc/profile.d ]; then
  for rc in ${DOTFILES}/etc/profile.d/*; do
    if [ -f "$rc" ]; then
      . "$rc"
    fi
  done
fi
